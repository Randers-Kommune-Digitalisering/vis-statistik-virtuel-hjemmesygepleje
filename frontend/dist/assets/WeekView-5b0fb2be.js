import{_ as w,r as h,w as C,a as x,o as u,c as _,d as m,e as g,p as D,f as y,b as s,i as f,t as k,F as S,j as $,k as P,v as F}from"./index-84fe410d.js";import{h as W}from"./moment-fbc5633a.js";import{P as z,B as T,C as A,A as B,c as I,p as V,a as O,d as U,L as E,b as N}from"./chartjs-plugin-datalabels.esm-c0f4456f.js";const G={props:{week:String},components:{Pie:z,Bar:T},setup(t){A.register(B,I,V,O,U,E,N);const a=h({});o(t.week),C(()=>t.week,l=>{o(l)});function o(l){fetch("/tablets/conversion?week="+l,{method:"GET"}).then(e=>e.json()).then(e=>{a.value.nexus_tablets=e.nexus_tablets,a.value.citizens=e.citizens;let n=0;e.nexus_tablets.forEach(r=>{n+=r.available});let i=0;e.vitacomm_tablets.forEach(r=>{i+=r.active});let c=0;e.citizens.forEach(r=>{c+=r.citizens}),a.value.nexus_units=e.nexus_tablets.map(r=>r.unit),a.value.nexus_active=n,a.value.vitacomm_active=i,a.value.citizens_total=c})}return{data:a}},computed:{nexusTotalChartData(){const t=this.data.nexus_active,a=this.data.citizens_total-t;return{labels:["Med skærm","Uden skærm"],datasets:[{backgroundColor:["green","red"],data:[t,a]}]}},vitacommTotalChartData(){const t=this.data.vitacomm_active,a=this.data.citizens_total-t;return{labels:["Med skærm","Uden skærm"],datasets:[{backgroundColor:["green","red"],data:[t,a]}]}},nexusUnitChartData(){return{labels:this.data.nexus_units,datasets:[{label:"Med skærm",backgroundColor:["green"],data:this.data.nexus_tablets.map(t=>t.on_loan)},{label:"Uden skærm",backgroundColor:["red"],data:this.data.citizens.filter(t=>{if(this.data.nexus_units.includes(t.unit))return t}).map(t=>t.citizens)}]}},pieChartOptions(){return{responsive:!0,maintainAspectRatio:!0,plugins:{datalabels:{formatter:(t,a)=>{let o=0;a.chart.data.datasets[0].data.map(n=>{o+=n});let e=(t*100/o).toFixed(0);return e=e>0?e+"%":"",e},color:"#fff"}}}},barChartOptions(){return{maintainAspectRatio:!1,barThickness:30,responsive:!0,scales:{x:{stacked:!0},y:{stacked:!0}},interaction:{mode:"index"},plugins:{datalabels:{formatter:(t,a)=>{const o=a.datasetIndex===0?1:0,l=a.chart.data.datasets[o].data[a.dataIndex]+t;let e=(t*100/l).toFixed(0);return e=e>0?e+"%":"",e},color:"#fff"}}}}}},b=t=>(D("data-v-d3a5482d"),t=t(),y(),t),M={class:"container"},R={key:0,class:"pie-chart-container"},j=b(()=>s("h2",null,"Nexus",-1)),L={key:1,class:"pie-chart-container"},Y=b(()=>s("h2",null,"Vitacomm",-1)),q={key:2,class:"bar-chart-container"},H=b(()=>s("h2",null,"Nexus",-1)),J={key:3,class:"bar-chart-container"},K=b(()=>s("h2",null,"Vitacomm",-1)),Q=b(()=>s("p",null,"Distrikter i Vitacomm og Nexus passer ikke sammen.",-1)),X=[K,Q];function Z(t,a,o,l,e,n){const i=x("Pie"),c=x("Bar");return u(),_("div",M,[l.data.citizens?(u(),_("div",R,[j,m(i,{data:n.nexusTotalChartData,options:n.pieChartOptions},null,8,["data","options"])])):g("",!0),l.data.citizens?(u(),_("div",L,[Y,m(i,{data:n.vitacommTotalChartData,options:n.pieChartOptions},null,8,["data","options"])])):g("",!0),l.data.citizens?(u(),_("div",q,[H,m(c,{data:n.nexusUnitChartData,options:n.barChartOptions},null,8,["data","options"])])):g("",!0),l.data.citizens?(u(),_("div",J,X)):g("",!0)])}const tt=w(G,[["render",Z],["__scopeId","data-v-d3a5482d"]]);const at={props:{week:String},components:{Pie:z,Bar:T},setup(t){A.register(B,I,V,O,U,E,N);const a=h({}),o=h(0),l=h(0),e=h([]),n=h([]),i=h([]);c(t.week),C(()=>t.week,r=>{c(r)});function c(r){fetch("/calls/citizens?week="+r,{method:"GET"}).then(d=>d.json()).then(d=>{console.log(d),o.value=d.calls_total[0].sum_duration,l.value=d.calls_total[0].avg_duration.split(".")[0],a.value=d.calls_total[0],e.value=d.calls_unit_answered.map(v=>v.unit),n.value=d.calls_unit_answered,i.value=d.calls_unit_duration.map(v=>(v.avg=v.avg.split(".")[0],v))})}return{calls_total:a,total_sum_duration:o,total_avg_duration:l,calls_units:e,calls_unit_answered:n,calls_unit_duration:i}},computed:{callsTotalChartData(){console.log(this.calls_unit_duration);let t=0,a=0;return this.calls_total&&(t=this.calls_total.answered,a=this.calls_total.unanswered),{labels:["Besvaret","Ubesvaret"],datasets:[{backgroundColor:["green","red"],data:[t,a]}]}},callsAnsweredUnitChartData(){return{labels:this.calls_units,datasets:[{label:"Besvaret",backgroundColor:["green"],data:this.calls_unit_answered.map(t=>t.answered)},{label:"Ubesvaret",backgroundColor:["red"],data:this.calls_unit_answered.map(t=>t.unanswered)}]}},pieChartOptions(){return{responsive:!0,maintainAspectRatio:!0,plugins:{datalabels:{formatter:(t,a)=>{let o=0;a.chart.data.datasets[0].data.map(n=>{o+=n});let e=(t*100/o).toFixed(0);return e=e>0?e+"%":"",e},color:"#fff"}}}},barChartOptions(){return{maintainAspectRatio:!1,indexAxis:"y",barThickness:30,responsive:!0,scales:{x:{stacked:!0},y:{stacked:!0}},interaction:{mode:"index"},plugins:{datalabels:{formatter:(t,a)=>{const o=a.datasetIndex===0?1:0,l=a.chart.data.datasets[o].data[a.dataIndex]+t;let e=(t*100/l).toFixed(0);return e=e>0?e+"%":"",e},color:"#fff"}}}}}},p=t=>(D("data-v-5d1c9525"),t=t(),y(),t),et={key:0,class:"container"},st={class:"pie-chart-container"},nt={class:"total-duration"},ot=p(()=>s("span",{class:"bold"},"Gennemsnit:",-1)),lt=p(()=>s("br",null,null,-1)),rt=p(()=>s("span",{class:"bold"},"Total:",-1)),it=p(()=>s("br",null,null,-1)),ct=p(()=>s("span",{class:"bold"},"Planlagt:",-1)),dt=p(()=>s("span",null," Distrikter i Vitacomm og Nexus passer ikke sammen.",-1)),ut={class:"bar-chart-container"},_t=p(()=>s("tr",null,[s("th",{class:"header"},"Enhed"),s("th",{class:"header"},"Gennemsnit"),s("th",{class:"header"},"Total"),s("th",{class:"header"},"Planlagt")],-1)),ht=p(()=>s("th",null,"Distrikter i Vitacomm og Nexus passer ikke sammen.",-1));function pt(t,a,o,l,e,n){const i=x("Pie"),c=x("Bar");return t.calls_totalclass?(u(),_("div",et,[s("div",st,[m(i,{data:n.callsTotalChartData,options:n.pieChartOptions},null,8,["data","options"]),s("div",nt,[ot,f(),s("span",null,k(l.total_avg_duration),1),lt,rt,f(),s("span",null,k(l.total_sum_duration),1),f(),it,ct,f(),dt])]),s("div",ut,[m(c,{data:n.callsAnsweredUnitChartData,options:n.barChartOptions},null,8,["data","options"])]),s("table",null,[_t,(u(!0),_(S,null,$(l.calls_unit_duration,r=>(u(),_("tr",{key:r},[s("th",null,k(r.unit),1),s("th",null,k(r.avg),1),s("th",null,k(r.sum),1),ht]))),128))])])):g("",!0)}const mt=w(at,[["render",pt],["__scopeId","data-v-5d1c9525"]]);const vt={class:"container"},kt=s("h1",null,"Omlægningsgrad",-1),gt=s("h1",null,"Opkald",-1),wt={__name:"WeekView",setup(t){let a=new Date;a.setDate(a.getDate()-7);const o=h(a.getFullYear()+"-W"+W(a).isoWeek());return(l,e)=>(u(),_("div",vt,[P(s("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>o.value=n),type:"week",class:"time-input"},null,512),[[F,o.value]]),kt,m(tt,{week:o.value},null,8,["week"]),gt,m(mt,{week:o.value},null,8,["week"])]))}};export{wt as default};
